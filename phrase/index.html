<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Qui parle ?</title>
    <link rel="icon" type="image/png" href="images/wonda.png"/>
    <link rel="stylesheet" href="style.css"/>
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
</head>
<body>
    <div class="container">
        <img src="../images/logo_sotdle.png" alt="Logo SOTDLE" class="site-logo" onclick="window.location.href='../index.html'"/>
        <h1><span class="emoji">🎤</span> Qui parle ?</h1>
        <div class="quote-box">
            <p class="quote" id="quote">"You break it, you buy it!"</p>
        </div>
        <input type="text" id="guess" placeholder="Entrez un nom..." autocomplete="off"/>
        <div class="suggestions" id="suggestions"></div>
        <div class="buttons">
            <button onclick="checkAnswer()">Valider</button>
            <button onclick="shareResult()"><span class="emoji">📩</span> Partager</button>
        </div>
        <p class="result" id="result"></p>
        <p class="countdown"><span class="emoji">⏳</span> Prochaine question dans <span id="timer"></span></p>
    </div>

    <script>
    const characters = [
        { name: "Wonda", quote: "You break it, you buy it!", image: "../images/wonda.png" },
        { name: "Larinna", quote: "I’ve got work for someone of your… talents.", image: "../images/larinna.png" },
        { name: "Merrick", quote: "I've lost my legs twice. Once to a shark, and once to grog.", image: "../images/derrick.png" },
        { name: "The Mysterious Stranger", quote: "You're not the first to seek the secrets of the Sea of Thieves.", image: "../images/mysterious_stranger.png" }
    ];

    const lockedImage = "images/ps-locked-item.png";
    const guessInput = document.getElementById("guess");
    const suggestionsContainer = document.getElementById("suggestions");
    const resultBox = document.getElementById("result");
    const quoteBox = document.getElementById("quote");

    const startDate = new Date("2024-01-01");
    const today = new Date();
    today.setHours(0,0,0,0);
    const index = Math.floor((today - startDate) / (1000*60*60*24)) % characters.length;
    const current = characters[index];
    quoteBox.textContent = `"${current.quote}"`;

    const hasAnswered = localStorage.getItem("answered-" + index);
    if (hasAnswered) {
        guessInput.disabled = true;
        guessInput.value = "Revenez demain";
        guessInput.classList.add("disabled");
    }

    guessInput.addEventListener("input", () => {
        const input = guessInput.value.trim().toLowerCase();
        suggestionsContainer.innerHTML = "";
        if (input === "") return;

        characters.forEach(char => {
            if (char.name.toLowerCase().startsWith(input)) {
                const suggestion = document.createElement("div");
                suggestion.className = "suggestion";
                suggestion.innerHTML = `
                    <img src="${char.image}" alt="${char.name}"/>
                    <span>${char.name}</span>
                `;
                if (hasAnswered && char.name !== current.name) {
                    suggestion.classList.add("locked");
                } else {
                    suggestion.addEventListener("click", () => {
                        guessInput.value = char.name;
                        suggestionsContainer.innerHTML = "";
                    });
                }
                suggestionsContainer.appendChild(suggestion);
            }
        });
    });

    function checkAnswer() {
        const userInput = guessInput.value.trim().toLowerCase();
        const correct = current.name.toLowerCase();

        if (userInput === correct) {
            resultBox.textContent = "🎉 Bravo, bonne réponse !";
            resultBox.style.color = "lime";
            localStorage.setItem("answered-" + index, "true");
            guessInput.disabled = true;
            guessInput.value = "Revenez demain";
            guessInput.classList.add("disabled");

            launchConfetti();
        } else {
            resultBox.textContent = "❌ Mauvaise réponse.";
            resultBox.style.color = "crimson";
            const wrongItem = Array.from(document.querySelectorAll(".suggestion")).find(s => s.textContent.trim() === guessInput.value);
            if (wrongItem) {
                wrongItem.classList.add("locked");
                const overlay = document.createElement("img");
                overlay.src = lockedImage;
                overlay.className = "lock-overlay";
                wrongItem.appendChild(overlay);
            }
        }
    }

    function shareResult() {
        const shareText = `La citation du jour : "${current.quote}"`;
        navigator.clipboard.writeText(shareText).then(() => {
            alert("Citation copiée !");
        });
    }

    function updateTimer() {
        const now = new Date();
        const tomorrow = new Date();
        tomorrow.setHours(24, 0, 0, 0);
        const diff = Math.floor((tomorrow - now) / 1000);
        const hours = String(Math.floor(diff / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((diff % 3600) / 60)).padStart(2, '0');
        const seconds = String(diff % 60).padStart(2, '0');
        document.getElementById("timer").textContent = `${hours}:${minutes}:${seconds}`;
    }

    setInterval(updateTimer, 1000);
    updateTimer();

    function launchConfetti() {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.innerHTML = "<h2>🎊 Félicitations ! 🎊</h2>";
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
    }
    </script>
</body>
</html>
