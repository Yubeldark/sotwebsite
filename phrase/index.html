<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Qui parle ? - Sea of Thieves</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon" />
</head>
<body>
  <div class="container">
    <h1>üéôÔ∏è Qui parle ?</h1>
    <div class="quote-box">
      <div class="quote" id="quote">Chargement de la citation...</div>
    </div>
    <input type="text" id="guess" placeholder="Entrez un nom..." autocomplete="off" />
    <ul id="suggestions"></ul>
    <div class="buttons">
      <button onclick="checkAnswer()">Valider</button>
      <button id="share" onclick="shareResult()">üì§ Partager</button>
    </div>
    <div class="result" id="result"></div>
    <div id="cooldown"></div>
  </div>

  <script defer>
    const characters = [
      {
        name: "Merrick",
        quote: "I've lost my legs twice. Once to a shark, and once to grog."
      },
      {
        name: "The Mysterious Stranger",
        quote: "You‚Äôre not the first to seek the secrets of the Sea of Thieves."
      },
      {
        name: "Larinna",
        quote: "I‚Äôve got work for someone of your‚Ä¶ talents."
      },
      {
        name: "Wonda",
        quote: "You break it, you buy it!"
      }
    ];

    function getDailyIndex() {
      const startDate = new Date("2024-01-01");
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const diffTime = today - startDate;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      return diffDays % characters.length;
    }

    const dailyIndex = getDailyIndex();
    const chosen = characters[dailyIndex];

    window.addEventListener("DOMContentLoaded", () => {
      const quoteElem = document.getElementById("quote");
      const inputField = document.getElementById("guess");
      const resultElem = document.getElementById("result");
      const shareBtn = document.getElementById("share");
      const cooldownElem = document.getElementById("cooldown");
      const suggestions = document.getElementById("suggestions");

      quoteElem.textContent = `"${chosen.quote}"`;

      const todayKey = new Date().toISOString().split("T")[0];
      const alreadyGuessed = localStorage.getItem("sot-guess") === todayKey;

      if (alreadyGuessed) lockGame();

      startCountdown();

      inputField.addEventListener("input", () => {
        const input = inputField.value.trim().toLowerCase();
        suggestions.innerHTML = "";
        if (input.length < 1) return;

        
        const matches = characters
          .filter(c => c.name.toLowerCase().startsWith(input))
          .slice(0, 5);

        matches.forEach(c => {
          const li = document.createElement("li");
          li.classList.add("suggestion");
          const img = document.createElement("img");
          img.src = `../images/${c.name.toLowerCase()}.png`;
          img.alt = c.name;
          img.onerror = () => img.style.display = "none";
          const span = document.createElement("span");
          span.textContent = c.name;
          li.appendChild(img);
          li.appendChild(span);
          li.onclick = () => {
            inputField.value = c.name;
            suggestions.innerHTML = "";
          };
          suggestions.appendChild(li);
        });

      });

      document.addEventListener("click", (e) => {
        if (e.target !== inputField) suggestions.innerHTML = "";
      });

      window.checkAnswer = () => {
        const input = inputField.value.trim().toLowerCase();
        const correct = chosen.name.toLowerCase();

        if (input === correct) {
          resultElem.textContent = "‚úÖ Bravo, bonne r√©ponse !";
          resultElem.style.color = "lime";
          inputField.disabled = true;
          inputField.placeholder = "";
          document.querySelector("button").disabled = true;
          shareBtn.style.display = "inline-block";
          localStorage.setItem("sot-guess", todayKey);
          showConfetti();
        } else {
          resultElem.textContent = "‚ùå Mauvaise r√©ponse, essaie encore.";
          resultElem.style.color = "red";
        }
      };

      window.shareResult = () => {
        const shareText = `ü¶ú Sea of Thieves - Qui parle ? (${todayKey})\nJ'ai devin√© la phrase du jour ! ‚öì\nhttps://yubeldark.github.io/sotwebsite/`;
        navigator.clipboard.writeText(shareText).then(() => {
          alert("R√©sultat copi√© dans le presse-papier !");
        });
      };

      function lockGame() {
        resultElem.textContent = "üîí Vous avez d√©j√† r√©pondu aujourd‚Äôhui.";
        resultElem.style.color = "#cccccc";
        inputField.disabled = true;
          inputField.placeholder = "";
        document.querySelector("button").disabled = true;
        shareBtn.style.display = "none";
      }

      
function showConfetti() {
  const confettiContainer = document.createElement("div");
  confettiContainer.id = "confetti-container";
  document.body.appendChild(confettiContainer);

  for (let i = 0; i < 100; i++) {
    const confetti = document.createElement("div");
    confetti.classList.add("confetti");
    confetti.style.left = Math.random() * 100 + "vw";
    confetti.style.animationDelay = Math.random() * 2 + "s";
    confetti.style.backgroundColor = ["#fcd303", "#ff6b6b", "#4ecdc4", "#ffe66d"][Math.floor(Math.random()*4)];
    confettiContainer.appendChild(confetti);
  }

  const congrats = document.createElement("div");
  congrats.id = "congrats";
  congrats.textContent = "üéâ F√©licitations ! üéâ";
  document.body.appendChild(congrats);

  setTimeout(() => {
    confettiContainer.remove();
    congrats.remove();
  }, 4000);
}


      function startCountdown() {
        function updateTimer() {
          const now = new Date();
          const midnight = new Date();
          midnight.setHours(24, 0, 0, 0);
          const diff = midnight - now;

          const hours = String(Math.floor(diff / 1000 / 60 / 60)).padStart(2, "0");
          const minutes = String(Math.floor((diff / 1000 / 60) % 60)).padStart(2, "0");
          const seconds = String(Math.floor((diff / 1000) % 60)).padStart(2, "0");

          cooldownElem.textContent = `‚è≥ Prochaine question dans ${hours}:${minutes}:${seconds}`;
        }

        updateTimer();
        setInterval(updateTimer, 1000);
      }
    });
  </script>
</body>
</html>
