<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Qui parle ? - Sea of Thieves</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
</head>
<body>
  <div class="container">
    <h1>ğŸ™ï¸ Qui parle ?</h1>
    <div class="quote-box">
      <div class="quote" id="quote">Chargement de la citation...</div>
    </div>
    <input type="text" id="guess" placeholder="Entrez un nom..." />
    <div class="buttons">
      <button onclick="checkAnswer()">Valider</button>
      <button id="share" onclick="shareResult()">ğŸ“¤ Partager</button>
    </div>
    <div class="result" id="result"></div>
    <div id="cooldown"></div>
  </div>

  <script>
    const characters = [
      {
        name: "Merrick",
        quote: "I've lost my legs twice. Once to a shark, and once to grog."
      },
      {
        name: "The Mysterious Stranger",
        quote: "Youâ€™re not the first to seek the secrets of the Sea of Thieves."
      },
      {
        name: "Larinna",
        quote: "Iâ€™ve got work for someone of yourâ€¦ talents."
      },
      {
        name: "Wonda",
        quote: "You break it, you buy it!"
      }
    ];

    function getDailyIndex() {
      const startDate = new Date("2024-01-01");
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const diffTime = today - startDate;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      return diffDays % characters.length;
    }

    const dailyIndex = getDailyIndex();
    const chosen = characters[dailyIndex];
    const quoteElem = document.getElementById("quote");
    const inputField = document.getElementById("guess");
    const resultElem = document.getElementById("result");
    const shareBtn = document.getElementById("share");
    const cooldownElem = document.getElementById("cooldown");

    window.onload = () => {
      quoteElem.textContent = `"${chosen.quote}"`;

      const todayKey = new Date().toISOString().split("T")[0];
      const alreadyGuessed = localStorage.getItem("sot-guess") === todayKey;

      if (alreadyGuessed) {
        lockGame();
      }

      startCountdown();
    };

    function checkAnswer() {
      const input = inputField.value.trim().toLowerCase();
      const correct = chosen.name.toLowerCase();

      if (input === correct) {
        resultElem.textContent = "âœ… Bravo, bonne rÃ©ponse !";
        resultElem.style.color = "lime";
        inputField.disabled = true;
        document.querySelector("button").disabled = true;
        shareBtn.style.display = "inline-block";

        const todayKey = new Date().toISOString().split("T")[0];
        localStorage.setItem("sot-guess", todayKey);
      } else {
        resultElem.textContent = "âŒ Mauvaise rÃ©ponse, essaie encore.";
        resultElem.style.color = "red";
      }
    }

    function shareResult() {
      const today = new Date().toISOString().split("T")[0];
      const shareText = `ğŸ¦œ Sea of Thieves - Qui parle ? (${today})\nJ'ai devinÃ© la phrase du jour ! âš“\nhttps://yubeldark.github.io/sotwebsite/`;

      navigator.clipboard.writeText(shareText).then(() => {
        alert("RÃ©sultat copiÃ© dans le presse-papier !");
      });
    }

    function lockGame() {
      resultElem.textContent = "ğŸ”’ Vous avez dÃ©jÃ  rÃ©pondu aujourdâ€™hui.";
      resultElem.style.color = "#cccccc";
      inputField.disabled = true;
      document.querySelector("button").disabled = true;
      shareBtn.style.display = "none";
    }

    function startCountdown() {
      function updateTimer() {
        const now = new Date();
        const midnight = new Date();
        midnight.setHours(24, 0, 0, 0);
        const diff = midnight - now;

        const hours = String(Math.floor(diff / 1000 / 60 / 60)).padStart(2, "0");
        const minutes = String(Math.floor((diff / 1000 / 60) % 60)).padStart(2, "0");
        const seconds = String(Math.floor((diff / 1000) % 60)).padStart(2, "0");

        cooldownElem.textContent = `â³ Prochaine question dans ${hours}:${minutes}:${seconds}`;
      }

      updateTimer();
      setInterval(updateTimer, 1000);
    }
  </script>
</body>
</html>
